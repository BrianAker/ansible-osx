#!/usr/bin/env ANSIBLE_HOSTS="localhost," ANSIBLE_CONNECTION=local ansible-playbook
# vim:ft=yaml
---
- name: install safari defaults
  hosts: localhost
  vars:
  tasks:
    - name: com.apple.Safari
      osx_defaults:
        domain: com.apple.Safari
        state: present
        key: "{{ item.key }}"
        type: "{{ item.type }}"
        value: "{{ item.value }}"
      with_items:
      - { key: "AlwaysShowTabBar", type: "bool", value: "true" }
      - { key: "CanPromptForPushNotifications", type: "bool", value: "false" }
      - { key: "Command1Through9SwitchesTabs", type: "bool", value: "true" }
      - { key: "ContentPageGroupIdentifier.WebKit2BackspaceKeyNavigationEnabled", type: "bool", value: "true" }
      - { key: "ContentPageGroupIdentifier.WebKit2TabsToLinks", type: "bool", value: "true" }
      - { key: "HomePage", type: "string", value: "" }
      - { key: "IncludeDevelopMenu", type: "bool", value: "true" }
      - { key: "SendDoNotTrackHTTPHeader", type: "bool", value: "true" }
      - { key: "ShowFavoritesBar", type: "bool", value: "true" }
      - { key: "ShowFullURLInSmartSearchField", type: "bool", value: "true" }
      - { key: "ShowSidebarInTopSites", type: "bool", value: "false" }
      - { key: "SuppressSearchSuggestions", type: "bool", value: "true" }
      - { key: "UniversalSearchEnabled", type: "bool", value: "true" }
      - { key: "UserStyleSheetLocationURLString", type: "string", value: "~/.safari/default.css" }
      - { key: "WebKitDeveloperExtras", type: "bool", value: "true" }
      - { key: "WebKitTabToLinksPreferenceKey", type: "bool", value: "true" }
#     - { key: "AutoOpenSafeDownloads", type: "bool", value: "false" }
#     - { key: "DebugSnapshotsUpdatePolicy", type: "int", value: "2" }
#     - { key: "FindOnPageMatchesWordStartsOnly", type: "bool", value: "false" }
#     - { key: "IncludeInternalDebugMenu", type: "bool", value: "true" }
#     - { key: "com.apple.Safari.ContentPageGroupIdentifier.WebKit2DeveloperExtrasEnabled", type: "bool", value: "true" }
    - name: com.apple.Safari
      osx_defaults:
        domain: com.apple.Safari.ContentPageGroupIdentifier
        state: present
        key: "{{ item.key }}"
        type: "{{ item.type }}"
        value: "{{ item.value }}"
      with_items:
      - { key: "WebKit2BackspaceKeyNavigationEnabled", type: "bool", value: "true" }
      - { key: "WebKit2TabsToLinks", type: "bool", value: "true" }

    - template:
        src: templates/default.css.j2
        dest: templates/default.css.j2
        mode: 0644
    - osx_defaults:
        domain:  "{{ osx_domain }}"
        key: "{{ item.key }}"
        type: "{{ item.type }}"
        value: "{{ item.value }}"
      with_items:  "{{ osx_domain_values | default([]) }}"
      when: osx_domain_values is defined
